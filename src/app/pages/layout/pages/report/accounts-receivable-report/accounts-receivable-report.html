<!-- accounts-receivable-report.html -->
<div class="accounts-receivable-report-component">
  <div class="row">
    <div class="title">Reporte de Cuentas por Cobrar</div>
    <div class="subtitle">
      Consulta ventas con saldo pendiente de cobro
    </div>
  </div>

  <div class="row filters">
    <div class="col">
      <label>Cliente:</label>
      <select [ngModel]="customerIdFilter()" (ngModelChange)="customerIdFilter.set($event ? +$event : null)">
        <option [value]="null">Todos</option>
        @for (customer of customers(); track customer.id) {
          <option [value]="customer.id">{{ customer.name }}</option>
        }
      </select>
    </div>

    <div class="col">
      <label>Forma de Pago:</label>
      <select [ngModel]="paymentIdFilter()" (ngModelChange)="paymentIdFilter.set($event ? +$event : null)">
        <option [value]="null">Todas</option>
        @for (payment of payments(); track payment.id) {
          <option [value]="payment.id">{{ payment.name }}</option>
        }
      </select>
    </div>

    <div class="col">
      <label>Desde:</label>
      <input type="date" [ngModel]="startDate()" (ngModelChange)="startDate.set($event)">
    </div>

    <div class="col">
      <label>Hasta:</label>
      <input type="date" [ngModel]="endDate()" (ngModelChange)="endDate.set($event)">
    </div>

    <div class="col">
      <button class="btn-search" (click)="loadReport()">Buscar</button>
      <button class="btn-print" (click)="onPrint()" [disabled]="cuentas().length === 0">Imprimir</button>
    </div>
  </div>

  @if (summary(); as s) {
  <div class="row summary">
    <div class="card">
      <div class="card-label">Total por Cobrar</div>
      <div class="card-value receivable">Bs. {{ s.totalPorCobrar | number:'1.2-2' }}</div>
      <div class="card-count">{{ s.cantidadVentas }} ventas</div>
    </div>

    <div class="card">
      <div class="card-label">Clientes</div>
      <div class="card-value">{{ s.cantidadClientes }}</div>
      <div class="card-count">con saldo pendiente</div>
    </div>
  </div>
  }

  <div class="row">
    <div class="col">
      @if (isLoading()) {
      <div class="loading">Cargando...</div>
      } @else if (cuentas().length === 0) {
      <div class="empty">No se encontraron cuentas por cobrar</div>
      } @else {
      <table>
        <thead>
          <tr>
            <th>VENTA</th>
            <th>CLIENTE</th>
            <th>FECHA</th>
            <th class="right">TOTAL</th>
            <th class="right">PAGADO</th>
            <th class="right">SALDO</th>
            <th class="center">D√çAS</th>
            <th>FORMA PAGO</th>
          </tr>
        </thead>
        <tbody>
          @for (cuenta of cuentas(); track trackById($index, cuenta)) {
          <tr>
            <td>{{ cuenta.ventaNumero }}</td>
            <td>{{ cuenta.cliente.nombre }}</td>
            <td>{{ formatBolivianDate(cuenta.fechaVenta) }}</td>
            <td class="right">Bs. {{ cuenta.totalVenta | number:'1.2-2' }}</td>
            <td class="right">Bs. {{ cuenta.totalPagado | number:'1.2-2' }}</td>
            <td class="right highlight">Bs. {{ cuenta.saldoPendiente | number:'1.2-2' }}</td>
            <td class="center" [class.days-alert]="cuenta.diasTranscurridos > 30">
              {{ cuenta.diasTranscurridos }}
            </td>
            <td>{{ cuenta.formaPago?.nombre || 'N/A' }}</td>
          </tr>
          }
        </tbody>
      </table>
      }
    </div>
  </div>
</div>