<div class="commission-report-component">
  <div class="row">
    <div class="title">Reporte de Comisiones</div>
    <div class="subtitle">
      Consulta comisiones pendientes y pagadas
    </div>
  </div>

  <div class="row filters">
    <div class="col">
      <label>Estado:</label>
      <select [ngModel]="statusFilter()" (ngModelChange)="statusFilter.set($event)">
        <option value="ALL">Todas</option>
        <option value="PENDING">Pendientes</option>
        <option value="PAID">Pagadas</option>
      </select>
    </div>

    <div class="col">
      <label>Desde:</label>
      <input type="date" [ngModel]="startDate()" (ngModelChange)="startDate.set($event)">
    </div>

    <div class="col">
      <label>Hasta:</label>
      <input type="date" [ngModel]="endDate()" (ngModelChange)="endDate.set($event)">
    </div>

    <div class="col">
      <button class="btn-search" (click)="loadReport()">Buscar</button>
      <button class="btn-print" (click)="onPrint()" [disabled]="comisiones().length === 0">Imprimir</button>
    </div>
  </div>

  @if (summary(); as s) {
  <div class="row summary">
    <div class="card">
      <div class="card-label">Pendiente</div>
      <div class="card-value pending">Bs. {{ s.totalPendiente | number:'1.2-2' }}</div>
      <div class="card-count">{{ s.cantidadPendiente }} comisiones</div>
    </div>

    <div class="card">
      <div class="card-label">Pagado</div>
      <div class="card-value paid">Bs. {{ s.totalPagado | number:'1.2-2' }}</div>
      <div class="card-count">{{ s.cantidadPagada }} comisiones</div>
    </div>
  </div>
  }

  <div class="row">
    <div class="col">
      @if (isLoading()) {
      <div class="loading">Cargando...</div>
      } @else if (comisiones().length === 0) {
      <div class="empty">No se encontraron comisiones</div>
      } @else {
      <table>
        <thead>
          <tr>
            <th>VENTA</th>
            <th>CLIENTE</th>
            <th>VENDEDOR</th>
            <th>FECHA</th>
            <th>TOTAL</th>
            <th>COSTO</th>
            <th>MARGEN</th>
            <th>COMISIÃ“N</th>
            <th>ESTADO</th>
          </tr>
        </thead>
        <tbody>
          @for (com of comisiones(); track trackById($index, com)) {
          <tr>
            <td>{{ com.ventaNumero }}</td>
            <td>{{ com.cliente }}</td>
            <td>{{ com.vendedor.nombre }}</td>
            <td>{{ formatBolivianDate(com.fechaVenta) }}</td>
            <td class="right">Bs. {{ com.totalVenta | number:'1.2-2' }}</td>
            <td class="right">Bs. {{ com.costoVenta | number:'1.2-2' }}</td>
            <td class="right">Bs. {{ com.margenBruto | number:'1.2-2' }}</td>
            <td class="right highlight">Bs. {{ com.montoComision | number:'1.2-2' }}</td>
            <td [class.status-pending]="com.estado === 'PENDIENTE'"
                [class.status-paid]="com.estado === 'PAGADO'">
              {{ translateStatus(com.estado) }}
            </td>
          </tr>
          }
        </tbody>
      </table>
      }
    </div>
  </div>
</div>